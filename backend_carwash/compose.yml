version: '3.8'

services:
  # üëá 1. ‡∏™‡πà‡∏ß‡∏ô Backend (NestJS)
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: carwash_backend
    ports:
      - '3000:3000'
    environment:
      # ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ DB (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!)
      - DB_HOST=db             # ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠ service ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà localhost)
      - DB_PORT=5432           # ‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏†‡∏≤‡∏¢‡πÉ‡∏ô container (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 5434)
      - DB_USERNAME=admin      # ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö POSTGRES_USER ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      - DB_PASSWORD=123451     # ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö POSTGRES_PASSWORD ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      - DB_NAME=carwashmini_dev # ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö POSTGRES_DB ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      - JWT_SECRET=secretKey123 # ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏° Secret Key
    depends_on:
      - db
    restart: always
    networks:
      - carwash_network

  # üëá 2. ‡∏™‡πà‡∏ß‡∏ô Database (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏°‡∏≤)
  db:
    image: postgres:14-alpine
    container_name: carwashmini
    restart: always
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: '123451' # ‡πÉ‡∏™‡πà quote ‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡πÑ‡∏ß‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö
      POSTGRES_DB: carwashmini_dev
    ports:
      - '5434:5432' # ‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ä‡πâ 5434, ‡πÅ‡∏ï‡πà Backend ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á‡πÉ‡∏ä‡πâ 5432
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - carwash_network

volumes:
  postgres_data:

networks:
  carwash_network: